<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Konfirmasi Pembayaran</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body>
    <div class="container mt-4">
        <h2>Konfirmasi Pembayaran</h2>

        <!-- Pencarian -->
        <div class="mt-4">
            <input type="text" id="searchInput" class="form-control" placeholder="Cari berdasarkan ID transaksi atau nama pelanggan..." oninput="filterPayments()">
        </div>

        <!-- Tabel Daftar Pembayaran -->
        <div class="mt-4">
            <table class="table table-bordered">
                <thead class="table-primary">
                    <tr>
                        <th>ID Transaksi</th>
                        <th>Nama Pelanggan</th>
                        <th>Total Pembayaran</th>
                        <th>Metode Pembayaran</th>
                        <th>Status</th>
                        <th>Aksi</th>
                    </tr>
                </thead>
                <tbody id="paymentTableBody">
                    <!-- Data pembayaran akan dimuat di sini -->
                </tbody>
            </table>
        </div>
    </div>

    <script>
        let payments = JSON.parse(localStorage.getItem("transactions")) || [];

        // Menampilkan daftar pembayaran ke tabel
        function loadPayments() {
            const paymentTableBody = document.getElementById("paymentTableBody");
            paymentTableBody.innerHTML = "";

            payments.forEach((payment, index) => {
                const row = document.createElement("tr");
                row.innerHTML = `
                    <td>${payment.id}</td>
                    <td>${payment.customerName || "N/A"}</td>
                    <td>${payment.total} IDR</td>
                    <td>${payment.paymentMethod}</td>
                    <td>
                        <span class="badge ${payment.transactionStatus === "lunas" ? "bg-success" : "bg-warning"}">
                            ${payment.transactionStatus === "lunas" ? "Lunas" : "Menunggu Pembayaran"}
                        </span>
                    </td>
                    <td>
                        ${
                            payment.transactionStatus === "menunggu"
                                ? `<button class="btn btn-sm btn-success" onclick="confirmPayment(${index})">Konfirmasi</button>`
                                : "-"
                        }
                    </td>
                `;
                paymentTableBody.appendChild(row);
            });
        }

        // Filter pembayaran berdasarkan pencarian
        function filterPayments() {
            const query = document.getElementById("searchInput").value.toLowerCase();
            const filteredPayments = payments.filter(payment =>
                payment.id.toLowerCase().includes(query) ||
                (payment.customerName && payment.customerName.toLowerCase().includes(query))
            );

            const paymentTableBody = document.getElementById("paymentTableBody");
            paymentTableBody.innerHTML = "";

            filteredPayments.forEach((payment, index) => {
                const row = document.createElement("tr");
                row.innerHTML = `
                    <td>${payment.id}</td>
                    <td>${payment.customerName || "N/A"}</td>
                    <td>${payment.total} IDR</td>
                    <td>${payment.paymentMethod}</td>
                    <td>
                        <span class="badge ${payment.transactionStatus === "lunas" ? "bg-success" : "bg-warning"}">
                            ${payment.transactionStatus === "lunas" ? "Lunas" : "Menunggu Pembayaran"}
                        </span>
                    </td>
                    <td>
                        ${
                            payment.transactionStatus === "menunggu"
                                ? `<button class="btn btn-sm btn-success" onclick="confirmPayment(${index})">Konfirmasi</button>`
                                : "-"
                        }
                    </td>
                `;
                paymentTableBody.appendChild(row);
            });
        }

        // Konfirmasi pembayaran
        function confirmPayment(index) {
            Swal.fire({
                title: "Konfirmasi Pembayaran",
                text: "Apakah Anda yakin ingin mengkonfirmasi pembayaran ini?",
                icon: "warning",
                showCancelButton: true,
                confirmButtonText: "Ya, Konfirmasi",
                cancelButtonText: "Batal"
            }).then(result => {
                if (result.isConfirmed) {
                    payments[index].transactionStatus = "lunas";
                    localStorage.setItem("transactions", JSON.stringify(payments));
                    Swal.fire("Sukses", "Pembayaran telah dikonfirmasi!", "success").then(() => loadPayments());
                }
            });
        }

        // Inisialisasi
        document.addEventListener("DOMContentLoaded", () => {
            loadPayments();
        });
    </script>
</body>
</html>
