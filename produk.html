<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manajemen Produk</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/uuid@8.3.2/dist/uuid.min.js"></script>
</head>
<body>
    <div class="container mt-4">
        <h2 class="text-center">Manajemen Produk</h2>

        <!-- Form Tambah Produk -->
        <div class="card mt-3 p-3">
            <h4>Tambah Produk</h4>
            <input type="hidden" id="productId">
            <input type="text" id="productName" class="form-control mb-2" placeholder="Nama Produk">
            <select id="productCategory" class="form-select mb-2">
                <option value="">Pilih Kategori</option>
            </select>
            <input type="number" id="productPrice" class="form-control mb-2" placeholder="Harga">
            <input type="number" id="productStock" class="form-control mb-2" placeholder="Stok">
            <input type="number" id="productDiscount" class="form-control mb-2" placeholder="Diskon (%)" value="0">
            <input type="file" id="productImage" class="form-control mb-2">
            <select id="productStatus" class="form-select mb-2">
                <option value="aktif">Aktif</option>
                <option value="nonaktif">Nonaktif</option>
            </select>
            <button class="btn btn-primary" onclick="saveProduct()">Simpan Produk</button>
        </div>

        <!-- Tabel Produk -->
        <h4 class="mt-4">Daftar Produk</h4>
        <table class="table table-bordered">
            <thead class="table-dark">
    <tr>
        <th>No</th>
        <th>ID Produk</th> <!-- Tambahkan kolom ID Produk -->
        <th>Nama Produk</th>
        <th>Kategori</th>
        <th>Harga</th>
        <th>Gambar</th>
        <th>Status</th>
        <th>Aksi</th>
    </tr>
</thead>
<tbody id="productTable"></tbody>
        </table>
    </div>

    <script>
        let products = JSON.parse(localStorage.getItem("products")) || [];
        let categories = JSON.parse(localStorage.getItem("categories")) || [];

        function loadCategories() {
            let categorySelect = document.getElementById("productCategory");
            categorySelect.innerHTML = '<option value="">Pilih Kategori</option>';
            categories.forEach(cat => {
                let option = document.createElement("option");
                option.value = cat.id;
                option.textContent = cat.name;
                categorySelect.appendChild(option);
            });
        }

        function saveProduct() {
            let id = document.getElementById("productId").value || uuid.v4();
            let name = document.getElementById("productName").value;
            let category = document.getElementById("productCategory").value;
            let price = document.getElementById("productPrice").value;
            let stock = document.getElementById("productStock").value;
            let discount = document.getElementById("productDiscount").value;
            let status = document.getElementById("productStatus").value;
            let imageFile = document.getElementById("productImage").files[0];

            if (!name || !category || !price || !stock) {
                Swal.fire("Error", "Mohon lengkapi semua data!", "error");
                return;
            }

            let imageUrl = "";
            if (imageFile) {
                let reader = new FileReader();
                reader.onload = function(e) {
                    imageUrl = e.target.result;
                    saveToLocalStorage(id, name, category, price, stock, discount, imageUrl, status);
                };
                reader.readAsDataURL(imageFile);
            } else {
                saveToLocalStorage(id, name, category, price, stock, discount, imageUrl, status);
            }
        }

        function saveToLocalStorage(id, name, category, price, stock, discount, imageUrl, status) {
            let existingProduct = products.find(p => p.id === id);
            if (existingProduct) {
                existingProduct.name = name;
                existingProduct.category = category;
                existingProduct.price = price;
                existingProduct.stock = stock;
                existingProduct.discount = discount;
                existingProduct.image = imageUrl;
                existingProduct.status = status;
            } else {
                products.push({ id, name, category, price, stock, discount, image: imageUrl, status });
            }

            localStorage.setItem("products", JSON.stringify(products));
            Swal.fire("Sukses", "Produk berhasil disimpan!", "success");
            resetForm();
            loadProducts();
        }

        function loadProducts() {
            let tbody = document.getElementById("productTable");
            tbody.innerHTML = products.map((p, i) => `
                <tr>
                    <td>${i + 1}</td>
                    <td>${p.name}</td>
                    <td>${categories.find(c => c.id === p.category)?.name || "Tidak Diketahui"}</td>
                    <td>${p.price} IDR</td>
                    <td>${p.stock}</td>
                    <td>${p.discount}%</td>
                    <td><img src="${p.image}" width="50"></td>
                    <td>${p.status}</td>
                    <td>
                        <button class="btn btn-warning btn-sm" onclick="editProduct('${p.id}')">Edit</button>
                        <button class="btn btn-danger btn-sm" onclick="deleteProduct('${p.id}')">Hapus</button>
                    </td>
                </tr>
            `).join("");
     }  



        function displayProducts() {
    let tbody = document.getElementById("productTable");
    tbody.innerHTML = "";
    products.forEach((product, index) => {
        tbody.innerHTML += `
            <tr>
                <td>${index + 1}</td>
                <td>${product.id}</td> <!-- Menampilkan UUID -->
                <td>${product.name}</td>
                <td>${product.category}</td>
                <td>IDR ${product.price.toLocaleString()}</td>
                <td><img src="${product.image}" width="50" height="50" alt="Gambar Produk"></td>
                <td>
                    <span class="badge bg-${product.status === 'aktif' ? 'success' : 'danger'}">
                        ${product.status}
                    </span>
                </td>
                <td>
                    <button class="btn btn-warning btn-sm" onclick="editProduct('${product.id}')">Edit</button>
                    <button class="btn btn-danger btn-sm" onclick="deleteProduct('${product.id}')">Hapus</button>
                </td>
            </tr>
        `;
    });
}



        

        function editProduct(id) {
            let product = products.find(p => p.id === id);
            if (!product) return;

            document.getElementById("productId").value = product.id;
            document.getElementById("productName").value = product.name;
            document.getElementById("productCategory").value = product.category;
            document.getElementById("productPrice").value = product.price;
            document.getElementById("productStock").value = product.stock;
            document.getElementById("productDiscount").value = product.discount;
            document.getElementById("productStatus").value = product.status;
        }

        function deleteProduct(id) {
            Swal.fire({
                title: "Konfirmasi",
                text: "Yakin ingin menghapus produk ini?",
                icon: "warning",
                showCancelButton: true,
                confirmButtonText: "Ya, hapus!",
                cancelButtonText: "Batal"
            }).then(result => {
                if (result.isConfirmed) {
                    products = products.filter(p => p.id !== id);
                    localStorage.setItem("products", JSON.stringify(products));
                    Swal.fire("Terhapus", "Produk berhasil dihapus!", "success");
                    loadProducts();
                }
            });
        }

        function resetForm() {
            document.getElementById("productId").value = "";
            document.getElementById("productName").value = "";
            document.getElementById("productCategory").value = "";
            document.getElementById("productPrice").value = "";
            document.getElementById("productStock").value = "";
            document.getElementById("productDiscount").value = "0";
            document.getElementById("productImage").value = "";
            document.getElementById("productStatus").value = "aktif";
        }

        loadCategories();
        loadProducts();
    </script>
</body>
</html>
