<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Point of Sale (POS)</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
    <style>
        body {
            font-family: 'Arial', sans-serif;
        }
        .navbar-brand {
            font-weight: bold;
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="#">POS</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="dashboard.html">Dashboard</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="laporan.html">Laporan</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="logout()">Logout</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container mt-4">
        <h2 class="text-center mb-4">Point of Sale (POS)</h2>

        <!-- Form Transaksi POS -->
        <form id="posForm">
            <div class="row g-3 mb-3">
                <div class="col-md-6">
                    <label for="customerId" class="form-label">Pelanggan</label>
                    <select id="customerId" class="form-select" required>
                        <option value="">Pilih Pelanggan</option>
                    </select>
                </div>
                <div class="col-md-6">
                    <label for="productId" class="form-label">Produk</label>
                    <select id="productId" class="form-select" required>
                        <option value="">Pilih Produk</option>
                    </select>
                </div>
            </div>
            <div class="row g-3 mb-3">
                <div class="col-md-6">
                    <label for="quantity" class="form-label">Jumlah</label>
                    <input type="number" id="quantity" class="form-control" required>
                </div>
                <div class="col-md-6">
                    <label for="paymentMethod" class="form-label">Metode Pembayaran</label>
                    <select id="paymentMethod" class="form-select" required>
                        <option value="">Pilih Metode Pembayaran</option>
                        <option value="Cash">Cash</option>
                        <option value="Credit Card">Credit Card</option>
                    </select>
                </div>
            </div>
            <div class="text-center">
                <button type="submit" class="btn btn-primary">Proses Transaksi</button>
            </div>
        </form>

        <!-- Keranjang Belanja -->
        <div class="mt-5">
            <h4>Keranjang Belanja</h4>
            <table class="table table-bordered table-striped">
                <thead class="table-primary">
                    <tr>
                        <th>No</th>
                        <th>Nama Produk</th>
                        <th>Harga</th>
                        <th>Jumlah</th>
                        <th>Total</th>
                        <th>Aksi</th>
                    </tr>
                </thead>
                <tbody id="cartTableBody">
                    <!-- Keranjang akan dimuat di sini -->
                </tbody>
            </table>
        </div>

        <!-- Konfirmasi Pembayaran -->
        <div class="mt-5">
            <h4>Konfirmasi Pembayaran</h4>
            <button id="confirmPaymentBtn" class="btn btn-success" onclick="confirmPayment()">Konfirmasi Pembayaran</button>
        </div>

        <!-- Laporan Transaksi -->
        <div class="mt-5">
            <h4>Laporan Transaksi</h4>
            <table class="table table-bordered table-striped">
                <thead class="table-primary">
                    <tr>
                        <th>No</th>
                        <th>ID Transaksi</th>
                        <th>Nama Pelanggan</th>
                        <th>Total Pembayaran</th>
                        <th>Status Pembayaran</th>
                    </tr>
                </thead>
                <tbody id="transactionReportBody">
                    <!-- Laporan transaksi akan dimuat di sini -->
                </tbody>
            </table>
        </div>
    </div>

    <script>
        let customers = JSON.parse(localStorage.getItem("customers")) || [];
        let products = JSON.parse(localStorage.getItem("products")) || [];
        let transactions = JSON.parse(localStorage.getItem("transactions")) || [];
        let cart = [];

        // Menampilkan pelanggan pada form select
        function loadCustomers() {
            const customerSelect = document.getElementById("customerId");
            customers.forEach(customer => {
                const option = document.createElement("option");
                option.value = customer.id;
                option.textContent = customer.name;
                customerSelect.appendChild(option);
            });
        }

        // Menampilkan produk pada form select
        function loadProducts() {
            const productSelect = document.getElementById("productId");
            products.forEach(product => {
                const option = document.createElement("option");
                option.value = product.id;
                option.textContent = product.name;
                productSelect.appendChild(option);
            });
        }

        // Menambahkan produk ke keranjang
        document.getElementById("posForm").addEventListener("submit", function (e) {
            e.preventDefault();
            const productId = document.getElementById("productId").value;
            const product = products.find(p => p.id === productId);
            const quantity = document.getElementById("quantity").value;
            const total = product.price * quantity;

            if (product && quantity > 0) {
                const cartItem = { productId, name: product.name, price: product.price, quantity, total };
                cart.push(cartItem);
                updateCartTable();
                Swal.fire("Sukses", "Produk ditambahkan ke keranjang!", "success");
            } else {
                Swal.fire("Gagal", "Produk atau jumlah tidak valid.", "error");
            }
        });

        // Update Tabel Keranjang Belanja
        function updateCartTable() {
            const tbody = document.getElementById("cartTableBody");
            tbody.innerHTML = "";

            cart.forEach((item, index) => {
                const tr = document.createElement("tr");
                tr.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${item.name}</td>
                    <td>${item.price}</td>
                    <td>${item.quantity}</td>
                    <td>${item.total}</td>
                    <td>
                        <button class="btn btn-danger btn-sm" onclick="removeFromCart(${index})">Hapus</button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        // Hapus item dari keranjang
        function removeFromCart(index) {
            cart.splice(index, 1);
            updateCartTable();
        }

        // Konfirmasi Pembayaran
        function confirmPayment() {
            if (cart.length === 0) {
                Swal.fire("Gagal", "Keranjang masih kosong.", "error");
                return;
            }

            const customerId = document.getElementById("customerId").value;
            const totalAmount = cart.reduce((sum, item) => sum + item.total, 0);
            const paymentMethod = document.getElementById("paymentMethod").value;
            const transactionId = Date.now(); // ID Transaksi Unik

            const transaction = {
                id: transactionId,
                customerId: customerId,
                totalAmount: totalAmount,
                paymentMethod: paymentMethod,
                status: 'Pembayaran Belum Dikonfirmasi'
            };

            transactions.push(transaction);
            localStorage.setItem("transactions", JSON.stringify(transactions));
            cart = []; // Clear cart
            updateCartTable();
            loadTransactionReport();
            Swal.fire("Sukses", "Transaksi berhasil! Menunggu konfirmasi pembayaran.", "success");
        }

        // Memuat laporan transaksi
        function loadTransactionReport() {
            const tbody = document.getElementById("transactionReportBody");
            tbody.innerHTML = "";

            transactions.forEach((transaction, index) => {
                const customer = customers.find(c => c.id === transaction.customerId);
                const tr = document.createElement("tr");
                tr.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${transaction.id}</td>
                    <td>${customer ? customer.name : "Tidak Diketahui"}</td>
                    <td>${transaction.totalAmount}</td>
                    <td>${transaction.status}</td>
                `;
                tbody.appendChild(tr);
            });
        }

        
// Fungsi untuk mengonfirmasi pembayaran
function confirmPayment() {
    if (cart.length === 0) {
        Swal.fire("Gagal", "Keranjang masih kosong.", "error");
        return;
    }

    const customerId = document.getElementById("customerId").value;
    const totalAmount = cart.reduce((sum, item) => sum + item.total, 0);
    const paymentMethod = document.getElementById("paymentMethod").value;
    const transactionId = Date.now(); // ID Transaksi Unik

    const transaction = {
        id: transactionId,
        customerId: customerId,
        totalAmount: totalAmount,
        paymentMethod: paymentMethod,
        status: 'Pembayaran Belum Dikonfirmasi'
    };

    transactions.push(transaction);
    localStorage.setItem("transactions", JSON.stringify(transactions));

    // Mengosongkan keranjang setelah transaksi
    cart = [];
    updateCartTable();

    // Memuat laporan transaksi setelah pembayaran
    loadTransactionReport();

    Swal.fire("Sukses", "Transaksi berhasil! Menunggu konfirmasi pembayaran.", "success");
}

// Fungsi untuk mengonfirmasi status pembayaran transaksi
function confirmTransactionPayment(transactionId) {
    const transaction = transactions.find(t => t.id === transactionId);
    
    if (transaction) {
        transaction.status = 'Sudah Dibayar';  // Mengubah status pembayaran
        localStorage.setItem("transactions", JSON.stringify(transactions));
        loadTransactionReport(); // Memuat ulang laporan transaksi
        Swal.fire("Sukses", "Pembayaran berhasil dikonfirmasi!", "success");
    } else {
        Swal.fire("Gagal", "Transaksi tidak ditemukan.", "error");
    }
}

// Memuat laporan transaksi yang sudah dilakukan
function loadTransactionReport() {
    const tbody = document.getElementById("transactionReportBody");
    tbody.innerHTML = "";

    transactions.forEach((transaction, index) => {
        const customer = customers.find(c => c.id === transaction.customerId);
        const tr = document.createElement("tr");
        tr.innerHTML = `
            <td>${index + 1}</td>
            <td>${transaction.id}</td>
            <td>${customer ? customer.name : "Tidak Diketahui"}</td>
            <td>${transaction.totalAmount}</td>
            <td>${transaction.status}</td>
            <td>
                ${transaction.status === 'Pembayaran Belum Dikonfirmasi' ? 
                    `<button class="btn btn-success btn-sm" onclick="confirmTransactionPayment(${transaction.id})">Konfirmasi Pembayaran</button>` : 
                    'Sudah Dibayar'
                }
            </td>
        `;
        tbody.appendChild(tr);
    });
}

        // Memulai aplikasi
        loadCustomers();
        loadProducts();
        loadTransactionReport();
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
