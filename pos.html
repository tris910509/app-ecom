<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Halaman POS</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="container mt-4">
        <h2>Point of Sale (POS)</h2>

        <!-- Formulir Pemilihan Pelanggan -->
        <div class="mt-4">
            <h4>Pilih Pelanggan</h4>
            <form id="posForm">
                <div class="mb-3">
                    <label for="customerRole" class="form-label">Pilih Role Pelanggan</label>
                    <select id="customerRole" class="form-select" onchange="handleCustomerRoleChange()">
                        <option value="umum">Umum</option>
                        <option value="pelsem">PelSem</option>
                        <option value="pelmem">PelMem</option>
                    </select>
                </div>

                <!-- Formulir Umum -->
                <div id="customerDetails" class="mb-3" style="display: none;">
                    <h5>Data Pelanggan</h5>
                    <label for="customerName" class="form-label">Nama Pelanggan</label>
                    <input type="text" id="customerName" class="form-control" placeholder="Nama Pelanggan" required>
                    <label for="contact" class="form-label">Kontak</label>
                    <input type="text" id="contact" class="form-control" placeholder="Kontak" required>
                    <label for="email" class="form-label">Email</label>
                    <input type="email" id="email" class="form-control" placeholder="Email" required>
                    <label for="address" class="form-label">Alamat</label>
                    <input type="text" id="address" class="form-control" placeholder="Alamat" required>
                </div>

                <!-- Pelanggan Pelsem/Pelmem -->
                <div id="existingCustomerDetails" class="mb-3" style="display: none;">
                    <h5>Data Pelanggan</h5>
                    <label for="customerID" class="form-label">ID Pelanggan</label>
                    <input type="text" id="customerID" class="form-control" readonly>
                    <label for="existingCustomerName" class="form-label">Nama Pelanggan</label>
                    <input type="text" id="existingCustomerName" class="form-control" readonly>
                    <label for="existingContact" class="form-label">Kontak</label>
                    <input type="text" id="existingContact" class="form-control" readonly>
                    <label for="existingEmail" class="form-label">Email</label>
                    <input type="email" id="existingEmail" class="form-control" readonly>
                    <label for="existingAddress" class="form-label">Alamat</label>
                    <input type="text" id="existingAddress" class="form-control" readonly>
                </div>

                <!-- Pilih Produk -->
                <div class="mb-3">
                    <label for="productSelect" class="form-label">Pilih Produk</label>
                    <select id="productSelect" class="form-select">
                        <option value="product1">Produk 1</option>
                        <option value="product2">Produk 2</option>
                        <option value="product3">Produk 3</option>
                    </select>
                </div>

                <!-- Keranjang Belanja -->
                <div class="mb-3">
                    <h5>Keranjang Belanja</h5>
                    <table class="table table-bordered" id="cartTable">
                        <thead>
                            <tr>
                                <th>Produk</th>
                                <th>Harga</th>
                                <th>Aksi</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Item keranjang akan ditambahkan di sini -->
                        </tbody>
                    </table>
                </div>

                <!-- Metode Pembayaran -->
                <div class="mb-3">
                    <label for="paymentMethod" class="form-label">Metode Pembayaran</label>
                    <select id="paymentMethod" class="form-select">
                        <option value="cash">Tunai</option>
                        <option value="creditCard">Kartu Kredit</option>
                        <option value="transfer">Transfer Bank</option>
                    </select>
                </div>

                <!-- Status Pembayaran -->
                <div class="mb-3">
                    <label for="paymentStatus" class="form-label">Status Pembayaran</label>
                    <select id="paymentStatus" class="form-select">
                        <option value="unpaid">Menunggu Pembayaran</option>
                        <option value="paid">Lunas</option>
                    </select>
                </div>

                <button type="submit" class="btn btn-primary">Proses Pembayaran</button>
            </form>
        </div>

        <!-- Notifikasi -->
        <div id="notification" class="mt-4"></div>
    </div>

    <script>
        // Data Transaksi (contoh)
        let transactions = [];

        // Data Produk (contoh)
        const products = {
            product1: { name: "Produk 1", price: 100000 },
            product2: { name: "Produk 2", price: 150000 },
            product3: { name: "Produk 3", price: 200000 }
        };

        // Keranjang Belanja
        let cart = [];

        // Handle perubahan Role Pelanggan
        function handleCustomerRoleChange() {
            const role = document.getElementById('customerRole').value;
            if (role === 'umum') {
                document.getElementById('customerDetails').style.display = 'block';
                document.getElementById('existingCustomerDetails').style.display = 'none';
            } else {
                document.getElementById('customerDetails').style.display = 'none';
                document.getElementById('existingCustomerDetails').style.display = 'block';
                loadCustomerData(role);
            }
        }

        // Fungsi untuk memuat data pelanggan berdasarkan role
        function loadCustomerData(role) {
            // Simulasi mengambil data pelanggan berdasarkan role
            const customers = JSON.parse(localStorage.getItem("customers")) || [];
            const customer = customers.find(c => c.role === role);

            if (customer) {
                document.getElementById('customerID').value = customer.id;
                document.getElementById('existingCustomerName').value = customer.name;
                document.getElementById('existingContact').value = customer.contact;
                document.getElementById('existingEmail').value = customer.email;
                document.getElementById('existingAddress').value = customer.address;
            } else {
                alert("Data pelanggan tidak ditemukan");
            }
        }

        // Menambah produk ke keranjang
        document.getElementById('productSelect').addEventListener('change', function () {
            const productId = this.value;
            addToCart(productId);
        });

        // Fungsi untuk menambahkan produk ke keranjang
        function addToCart(productId) {
            const product = products[productId];
            if (product) {
                cart.push(product);
                updateCart();
            }
        }

        // Fungsi untuk memperbarui tampilan keranjang
        function updateCart() {
            const cartTable = document.getElementById('cartTable').getElementsByTagName('tbody')[0];
            cartTable.innerHTML = ''; // Kosongkan tabel

            cart.forEach((product, index) => {
                const row = cartTable.insertRow();
                row.innerHTML = `
                    <td>${product.name}</td>
                    <td>${product.price} IDR</td>
                    <td><button class="btn btn-danger" onclick="removeFromCart(${index})">Hapus</button></td>
                `;
            });
        }

        // Fungsi untuk menghapus produk dari keranjang
        function removeFromCart(index) {
            cart.splice(index, 1);
            updateCart();
        }

        // Fungsi untuk menangani proses pembayaran
        document.getElementById('posForm').addEventListener('submit', function (e) {
            e.preventDefault();
            const paymentStatus = document.getElementById('paymentStatus').value;
            const paymentMethod = document.getElementById('paymentMethod').value;
            const customerRole = document.getElementById('customerRole').value;
            const customerName = customerRole === 'umum' ? document.getElementById('customerName').value : document.getElementById('existingCustomerName').value;

            const totalAmount = cart.reduce((total, product) => total + product.price, 0);
            const transaction = {
                id: `T${Math.random().toString(36).substr(2, 9)}`,
                customerName: customerName,
                products: cart.map(product => product.name),
                totalAmount: totalAmount,
                paymentMethod: paymentMethod,
                paymentStatus: paymentStatus,
                date: new Date().toISOString().split('T')[0] // Date formatted as YYYY-MM-DD
            };

            transactions.push(transaction);
            localStorage.setItem("transactions", JSON.stringify(transactions));
            Swal.fire({
                icon: 'success',
                title: 'Pembayaran Berhasil',
                text: `Transaksi ${transaction.id} berhasil diproses. Total: ${totalAmount} IDR.`,
            });

            // Clear keranjang setelah transaksi
            cart = [];
            updateCart();
        });
    </script>
</body>
</html>
