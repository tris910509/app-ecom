<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>POS dengan Data Otomatis</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body>
    <div class="container mt-4">
        <h2 class="text-center">POS - Data Pelanggan dan Produk</h2>

        <!-- Form POS -->
        <form id="posForm" class="mt-4">
            <!-- Pilih Role Pelanggan -->
            <div class="mb-3">
                <label for="customerRole" class="form-label">Pilih Role Pelanggan</label>
                <select id="customerRole" class="form-select" onchange="handleRoleChange()">
                    <option value="umum">Umum</option>
                    <option value="pelsem">PelSem</option>
                    <option value="pelmem">PelMem</option>
                </select>
            </div>

            <!-- Data Pelanggan -->
            <div id="customerInfo">
                <div class="mb-3">
                    <label for="customerName" class="form-label">Nama Pelanggan</label>
                    <input type="text" id="customerName" class="form-control" required>
                </div>
                <div class="mb-3">
                    <label for="customerContact" class="form-label">Kontak</label>
                    <input type="text" id="customerContact" class="form-control" required>
                </div>
                <div class="mb-3">
                    <label for="customerEmail" class="form-label">Email</label>
                    <input type="email" id="customerEmail" class="form-control">
                </div>
                <div class="mb-3">
                    <label for="customerAddress" class="form-label">Alamat</label>
                    <textarea id="customerAddress" class="form-control"></textarea>
                </div>
            </div>

            <!-- Pilih Produk -->
            <div class="mb-3">
                <label for="productSelect" class="form-label">Pilih Produk</label>
                <select id="productSelect" class="form-select" required>
                    <!-- Produk akan dimuat otomatis -->
                </select>
            </div>

            <!-- Jumlah Produk -->
            <div class="mb-3">
                <label for="quantity" class="form-label">Jumlah</label>
                <input type="number" id="quantity" class="form-control" value="1" min="1" required>
            </div>
            <button type="button" class="btn btn-primary" onclick="addToCart()">Tambah ke Keranjang</button>
        </form>

        <!-- Keranjang -->
        <div class="mt-4">
            <h5>Keranjang</h5>
            <table class="table table-bordered" id="cartTable">
                <thead>
                    <tr>
                        <th>Produk</th>
                        <th>Harga</th>
                        <th>Jumlah</th>
                        <th>Diskon</th>
                        <th>Total</th>
                        <th>Aksi</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
            <h5>Subtotal: <span id="subtotal">0</span> IDR</h5>
        </div>
    </div>

    <script>
        // Data Pelanggan (Pelsem dan Pelmem)
        const customers = [
            { id: 'CUS001', name: 'Andi', role: 'PelSem', contact: '08123456789', email: 'andi@example.com', address: 'Jl. Mawar 1' },
            { id: 'CUS002', name: 'Budi', role: 'PelMem', contact: '08198765432', email: 'budi@example.com', address: 'Jl. Melati 2' }
        ];

        // Data Produk
        const products = [
            { id: 'PROD001', name: 'Produk A', price: 50000 },
            { id: 'PROD002', name: 'Produk B', price: 75000 },
            { id: 'PROD003', name: 'Produk C', price: 100000 }
        ];

        let cart = [];
        let subtotal = 0;

        // Load Produk
        function loadProducts() {
            const productSelect = document.getElementById('productSelect');
            products.forEach(product => {
                const option = document.createElement('option');
                option.value = product.id;
                option.textContent = `${product.name} - ${product.price} IDR`;
                productSelect.appendChild(option);
            });
        }

        // Role Change Handler
        function handleRoleChange() {
            const role = document.getElementById('customerRole').value;
            const customerInfo = document.getElementById('customerInfo');
            if (role === 'umum') {
                customerInfo.style.display = 'block';
                document.getElementById('customerName').value = '';
                document.getElementById('customerContact').value = '';
                document.getElementById('customerEmail').value = '';
                document.getElementById('customerAddress').value = '';
            } else {
                const customer = customers.find(c => c.role.toLowerCase() === role);
                if (customer) {
                    document.getElementById('customerName').value = customer.name;
                    document.getElementById('customerContact').value = customer.contact;
                    document.getElementById('customerEmail').value = customer.email;
                    document.getElementById('customerAddress').value = customer.address;
                }
                customerInfo.style.display = 'none';
            }
        }

        // Tambah ke Keranjang
        function addToCart() {
            const productId = document.getElementById('productSelect').value;
            const quantity = parseInt(document.getElementById('quantity').value);
            const product = products.find(p => p.id === productId);

            if (product) {
                const total = product.price * quantity;
                cart.push({ product, quantity, total, discount: 0 });
                updateCart();
            }
        }

        // Update Keranjang
        function updateCart() {
            const cartTableBody = document.getElementById('cartTable').getElementsByTagName('tbody')[0];
            cartTableBody.innerHTML = '';
            subtotal = 0;

            cart.forEach((item, index) => {
                subtotal += item.total - item.discount;
                const row = cartTableBody.insertRow();
                row.innerHTML = `
                    <td>${item.product.name}</td>
                    <td>${item.product.price}</td>
                    <td>${item.quantity}</td>
                    <td>
                        <input type="number" class="form-control" value="${item.discount}" 
                               onchange="applyDiscount(${index}, this.value)">
                    </td>
                    <td>${item.total - item.discount}</td>
                    <td>
                        <button class="btn btn-danger btn-sm" onclick="removeFromCart(${index})">Hapus</button>
                    </td>
                `;
            });

            document.getElementById('subtotal').innerText = subtotal;
        }

        // Diskon
        function applyDiscount(index, discount) {
            cart[index].discount = parseInt(discount) || 0;
            updateCart();
        }

        // Hapus dari Keranjang
        function removeFromCart(index) {
            cart.splice(index, 1);
            updateCart();
        }

        loadProducts();
    </script>
</body>
</html>
