<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem POS</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/sweetalert2@10.16.7/dist/sweetalert2.min.css" rel="stylesheet">
</head>
<body>

<!-- Form Transaksi POS -->
<div class="container mt-5">
    <h4>Form Transaksi POS</h4>
    <form id="posForm">
        <div class="row mb-3">
            <div class="col-md-6">
                <label for="transactionId" class="form-label">ID Transaksi</label>
                <input type="text" id="transactionId" class="form-control" readonly>
            </div>
            <div class="col-md-6">
                <label for="customerRole" class="form-label">Role Pelanggan</label>
                <select id="customerRole" class="form-select">
                    <option value="umum">Umum</option>
                    <option value="pelsem">PelSem</option>
                    <option value="pelmem">PelMem</option>
                </select>
            </div>
        </div>

        <div class="row mb-3">
            <div class="col-md-6">
                <label for="productSelect" class="form-label">Pilih Produk</label>
                <select id="productSelect" class="form-select">
                    <option value="product1">Produk A - Rp 50,000</option>
                    <option value="product2">Produk B - Rp 75,000</option>
                    <option value="product3">Produk C - Rp 100,000</option>
                </select>
            </div>
            <div class="col-md-6">
                <label for="quantity" class="form-label">Jumlah</label>
                <input type="number" id="quantity" class="form-control" value="1">
            </div>
        </div>

        <h5>Keranjang</h5>
        <table id="cartTable" class="table table-bordered">
            <thead>
                <tr>
                    <th>Nama Produk</th>
                    <th>Harga</th>
                    <th>Jumlah</th>
                    <th>Diskon (%)</th>
                    <th>Total</th>
                    <th>Aksi</th>
                </tr>
            </thead>
            <tbody id="cartItems"></tbody>
        </table>

        <button type="button" id="addToCart" class="btn btn-primary">Tambah ke Keranjang</button>
        <button type="button" id="processPayment" class="btn btn-success mt-3">Proses Pembayaran</button>
    </form>
</div>

<!-- Script -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@10.16.7/dist/sweetalert2.all.min.js"></script>
<script>
    // Fungsi untuk menghasilkan ID transaksi otomatis
    function generateTransactionId() {
        return 'TRX-' + new Date().getTime();
    }

    // Fungsi untuk menambahkan produk ke keranjang
    function addToCart() {
        const productSelect = document.getElementById("productSelect");
        const selectedProduct = productSelect.options[productSelect.selectedIndex].text.split(" - ");
        const productName = selectedProduct[0];
        const productPrice = parseInt(selectedProduct[1].replace("Rp ", "").replace(",", ""));

        const quantity = parseInt(document.getElementById("quantity").value) || 1;
        const discount = 0; // Default diskon saat pertama kali dimasukkan
        const total = productPrice * quantity;

        const cartTable = document.getElementById("cartItems");
        const row = document.createElement("tr");

        row.innerHTML = `
            <td>${productName}</td>
            <td>Rp ${productPrice}</td>
            <td contenteditable="true" oninput="updateTotal(this)">1</td>
            <td contenteditable="true" oninput="updateTotal(this)">0</td>
            <td>Rp ${total}</td>
            <td><button class="btn btn-danger btn-sm" onclick="removeItem(this)">Hapus</button></td>
        `;
        cartTable.appendChild(row);
    }

    // Fungsi untuk memperbarui total saat jumlah atau diskon diubah
    function updateTotal(cell) {
        const row = cell.parentNode;
        const price = parseInt(row.cells[1].textContent.replace("Rp ", "").replace(",", ""));
        const quantity = parseInt(row.cells[2].textContent) || 0;
        const discount = parseInt(row.cells[3].textContent) || 0;

        const total = price * quantity * (1 - discount / 100);
        row.cells[4].textContent = `Rp ${total.toFixed(0)}`;
    }

    // Fungsi untuk menghapus item dari keranjang
    function removeItem(button) {
        const row = button.parentNode.parentNode;
        row.parentNode.removeChild(row);
    }

    // Fungsi untuk memproses pembayaran
    function processPayment() {
        const cartTable = document.getElementById("cartItems");
        const rows = cartTable.getElementsByTagName("tr");

        let totalPayment = 0;
        for (let row of rows) {
            const total = parseInt(row.cells[4].textContent.replace("Rp ", "").replace(",", ""));
            totalPayment += total;
        }

        const paymentAmount = parseInt(prompt(`Total Pembayaran: Rp ${totalPayment}. Masukkan jumlah pembayaran:`));

        if (paymentAmount >= totalPayment) {
            const change = paymentAmount - totalPayment;
            Swal.fire("Pembayaran Sukses", `Pembayaran Anda Lunas. Kembalian: Rp ${change}`, "success");
        } else {
            Swal.fire("Pembayaran Gagal", "Jumlah pembayaran kurang.", "error");
        }
    }

    // Event Listener
    document.getElementById("transactionId").value = generateTransactionId();
    document.getElementById("addToCart").addEventListener("click", addToCart);
    document.getElementById("processPayment").addEventListener("click", processPayment);
</script>

</body>
</html>
